"use strict";function SetupUI(){$("#btn_proceed").click(onBtnProceed),$("#btn_back").click(onBtnBack)}function RenderItemsIntoTable(){for(var t="",e=0,r=0,i=window._shoppingCart.server_settings.currency,a=0;a<window._wcOrder.line_items.length;a++){var o=window._wcOrder.line_items[a];o.subtotal=parseFloat(o.subtotal),o.subtotal_tax=parseFloat(o.subtotal_tax),o.total=parseFloat(o.total),o.total_tax=parseFloat(o.total_tax);for(var d=null,n=0;n<window._shoppingCart.cart_items.length;n++){var l=window._shoppingCart.cart_items[n];if(l.product_id==o.product_id||l.product_id==o.variation_id){d=l;break}}d.qty=parseFloat(d.qty),d.unit_price=parseFloat(d.unit_price),d.unit_tax=o.subtotal_tax/o.quantity,d.subtotal=o.subtotal+o.subtotal_tax,e+=o.subtotal,r+=o.subtotal_tax,t+="<tr>",t+="<td>",t+='<img src="'+d.image+'" />',t+="</td>",t+="<td>",t+=d.name,t+="</td>",t+='<td style="text-align: right">',t+=d.qty,t+="</td>",t+='<td style="text-align: right">',t+=util.ParseCurrencyToDisp(i,d.unit_price,!1),t+="</td>",t+='<td style="text-align: right">',t+=util.ParseCurrencyToDisp(i,d.unit_tax,!1),t+="</td>",t+='<td style="text-align: right">',t+=util.ParseCurrencyToDisp(i,d.subtotal),t+="</td>",t+="</tr>"}var s=parseFloat(window._wcOrder.shipping_total),u=parseFloat(window._wcOrder.shipping_tax),c=e+r+s+u;$("#order_total").html(util.ParseCurrencyToDisp(i,e)),$("#order_tax").html(util.ParseCurrencyToDisp(i,r)),$("#ship_total").html(util.ParseCurrencyToDisp(i,s)),$("#ship_tax").html(util.ParseCurrencyToDisp(i,u)),$("#total_amount").html(util.ParseCurrencyToDisp(i,c)),$("#table_items tbody").html(t)}function LoadShoppingCart(){return $.ajax({method:"GET",url:"ws/db_loadcart",data:{uid:window._userId,rid:window._recipientId}})}function LoadWcOrder(){return $.ajax({method:"GET",url:"get_wc_order",data:{uid:window._userId,rid:window._recipientId,oid:window._orderId}})}function RemoveWcOrder(){return $.ajax({type:"DELETE",url:"ws/delete_order",data:{oid:window._orderId,uid:window._userId,rid:window._recipientId}})}function EnableAllButtons(t){t?($("#btn_proceed").removeClass("disabled loading"),$("#btn_back").removeClass("disabled loading")):($("#btn_proceed").addClass("disabled loading"),$("#btn_back").addClass("disabled loading"))}function onBtnBack(t){var e=$("#dlg_discardwarn");e.modal("show"),e.find("#btn_ok").click(function(t){EnableAllButtons(!1),RemoveWcOrder().done(function(){var t="mwp?page=shopCart&uid="+window._userId+"&rid="+window._recipientId;window.location.href=t}).fail(function(t,e,r){$.alert({type:"red",useBootstrap:!1,title:r,content:t.responseText})})}),e.find("#btn_cancel").click(function(t){$("#dlg_discardwarn").modal("hide")})}function onBtnProceed(t){EnableAllButtons(!1),window.location.href="mwp?page=orderPayment&oid="+window._orderId+"&uid="+window._userId+"&rid="+window._recipientId}$(document).ready(function(){RenderItemsIntoTable(),$(".loading_wrapper").hide(),$(".loaded_wrapper").show(),SetupUI()});