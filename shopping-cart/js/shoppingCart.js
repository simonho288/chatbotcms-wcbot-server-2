"use strict";function LoadShoppingCart(){return $.ajax({method:"GET",url:"ws/db_loadcart",data:{uid:window._userId,rid:window._recipientId}})}function DoCheckout(){var t="mwp?page=orderInfoInput&uid="+window._userId+"&rid="+window._recipientId;null!=window._orderId&&""!=window._orderId&&(t+="&oid="+window._orderId),window.location.href=t}function SaveCart(t){var e=util.CloneObject(window._shoppingCart);delete e.server_settings,$.ajax({type:"POST",url:"ws/db_savecart",data:JSON.stringify({userId:window._userId,recipientId:window._recipientId,cart:e}),contentType:"application/json"}).done(function(e){"ok"===e&&t&&t(!0)}).fail(function(e,i,n){$.alert({type:"red",useBootstrap:!1,title:e,content:n.responseText}),t&&t(!1)})}function findItemInCart(t){for(var e=0;e<window._shoppingCart.cart_items.length;++e){var i=window._shoppingCart.cart_items[e];if(i.product_id==t)return i}}function CalculateTotal(){var t=0;$(".card").each(function(e,i){var n=findItemInCart($(this).data("itemid"));t+=parseInt(n.qty)*parseFloat(n.unit_price)});var e=util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,t);$("#amount").html(e)}function RemoveItemFromCart(t){for(var e=[],i=0;i<window._shoppingCart.cart_items.length;++i){var n=window._shoppingCart.cart_items[i];n.product_id!=t&&e.push(n)}window._shoppingCart.cart_items=e,RenderCartAndSetupEvent()}function EnableAllButtons(t){t?$("#btn_checkout").removeClass("disabled loading"):$("#btn_checkout").addClass("disabled loading")}function RenderCartToElem(){var t=window._shoppingCart.cart_items,e=$("#cartItem").html(),i="";if(0===t.length)i="No items in shopping cart. Please close this window and add item to cart in Messenger";else for(var n=0;n<t.length;++n){for(var r=t[n],a="",o=1;o<100;o++)o!=r.qty?a+='<option value="'+o+'">'+o+"</option>":a+='<option value="'+o+'" selected="selected">'+o+"</option>";var d=r.qty*parseFloat(r.unit_price),c=util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,d,!1);i+=e.replace(/item_image/g,r.image).replace(/item_itemName/g,r.name).replace(/item_itemId/g,r.product_id).replace(/item_unitPrice/g,numeral(r.unit_price).format("0,0[.]00")).replace(/item_subTotal/g,c).replace(/item_qtyDropDown/g,a)}$("#cartitems_div").html(i),0===t.length&&$("#btn_checkout").attr("disabled","disabled"),CalculateTotal()}function RenderCartAndSetupEvent(){RenderCartToElem();window._shoppingCart.cart_items;$(".item_qty").off().on("change",function(t){var e=t.target.value,i=findItemInCart(t.target.id);i.qty=e;var n=e*i.unit_price,r="Sub-total: "+util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,n,!1);$(t.target).closest(".card").find(".sub_total").html(r),SaveCart(),CalculateTotal()}),$(".btn_remove").off().on("click",function(t){RemoveItemFromCart($(this).data("itemid")),SaveCart()})}$(document).ready(function(){$(".loading_wrapper").hide(),$(".loaded_wrapper").show(),RenderCartAndSetupEvent(),$(".main.menu").visibility({type:"fixed"}),$(".overlay").visibility({type:"fixed",offset:80}),$(".image").visibility({type:"image",transition:"vertical flip in",duration:500}),$(".main.menu .ui.dropdown").dropdown({on:"hover"}),$("#btn_checkout").on("click",function(t){EnableAllButtons(!1),SaveCart(function(t){t&&DoCheckout()})})});